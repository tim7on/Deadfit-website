---
// src/components/Header.astro
import { appName, BASE_ROUTE } from '../constants/info'
import LanguagePicker from './LanguagePicker.astro'
import { getLangFromUrl, useTranslatedPath } from '../i18n/utils'

const currentLang = getLangFromUrl(Astro.url)
const translatePath = useTranslatedPath(currentLang)
const isHomepage =
	Astro.url.pathname === translatePath('') ||
	Astro.url.pathname === translatePath('/') + '/'
---

<header class='header-glass'>
	<div
		class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between'
	>
		<a
			href={translatePath('')}
			class='logo-link'
			aria-label='Go to homepage'
			id='logo-link'
			data-is-homepage={isHomepage}
		>
			<div class='logo-container'>
				<img
					src={`${BASE_ROUTE}/favicon.svg`}
					alt={`${appName} logo`}
					class='logo-image'
				/>
			</div>
			<span class='logo-text'>
				<span class='logo-gradient'>{appName}</span>
			</span>
		</a>
		<LanguagePicker />
	</div>
</header>

<script>
	document.addEventListener('astro:page-load', () => {
		const logoLink = document.getElementById('logo-link')
		if (!logoLink) return

		logoLink.addEventListener('click', event => {
			if (logoLink.dataset.isHomepage === 'true') {
				event.preventDefault()
				window.scrollTo({
					top: 0,
					behavior: 'smooth',
				})
			}
		})

		// Add scroll effect
		let lastScroll = 0
		const header = document.querySelector('.header-glass')

		window.addEventListener('scroll', () => {
			const currentScroll = window.pageYOffset

			if (currentScroll > 50) {
				header?.classList.add('scrolled')
			} else {
				header?.classList.remove('scrolled')
			}

			lastScroll = currentScroll
		})
	})
</script>

<style>
	/* Header Glass Effect */
	.header-glass {
		position: sticky;
		top: 0;
		z-index: 50;
		background: rgba(255, 255, 255, 0.7);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		border-bottom: 1px solid rgba(0, 0, 0, 0.05);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.header-glass.scrolled {
		background: rgba(255, 255, 255, 0.85);
		border-bottom: 1px solid rgba(0, 0, 0, 0.1);
		box-shadow:
			0 4px 6px -1px rgba(0, 0, 0, 0.05),
			0 2px 4px -1px rgba(0, 0, 0, 0.03);
	}

	/* Logo Styles */
	.logo-link {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		text-decoration: none;
		transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.logo-link:hover {
		transform: scale(1.02);
	}

	.logo-container {
		position: relative;
		width: 2.5rem;
		height: 2.5rem;
		background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
		border-radius: 0.75rem;
		padding: 0.5rem;
		box-shadow:
			0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.logo-link:hover .logo-container {
		box-shadow:
			0 10px 15px -3px rgba(0, 0, 0, 0.1),
			0 4px 6px -2px rgba(0, 0, 0, 0.05);
		transform: rotate(-5deg);
	}

	.logo-image {
		width: 100%;
		height: 100%;
		object-fit: contain;
	}

	.logo-text {
		font-size: 1.25rem;
		font-weight: 700;
		color: #111827;
		transition: all 0.3s ease;
	}

	.logo-gradient {
		background: linear-gradient(
			135deg,
			#4f46e5 0%,
			#7c3aed 50%,
			#ec4899 100%
		);
		background-clip: text;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 200% auto;
		animation: gradient-shift 3s ease infinite;
	}

	@keyframes gradient-shift {
		0%,
		100% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
	}

	/* Responsive */
	@media (max-width: 640px) {
		.logo-text {
			font-size: 1.125rem;
		}

		.logo-container {
			width: 2.25rem;
			height: 2.25rem;
		}
	}

	/* Reduced Motion */
	@media (prefers-reduced-motion: reduce) {
		*,
		*::before,
		*::after {
			animation-duration: 0.01ms !important;
			animation-iteration-count: 1 !important;
			transition-duration: 0.01ms !important;
		}
	}
</style>
